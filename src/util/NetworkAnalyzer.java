package util;import java.util.Calendar;import java.util.ArrayList;import java.util.Collections;import java.util.Comparator;import java.util.HashMap;import java.util.HashSet;import java.util.LinkedHashMap;import java.util.List;import java.util.Map;import java.util.Set;import basic.preparation.*;/** * ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã‚’å?æã™ã‚‹ã‚¯ãƒ©ã‚¹ *  * @author tori * */public class NetworkAnalyzer {		SimpleNetwork<Node, Link> network;				public NetworkAnalyzer(Network network) {		super();		this.network = new SimpleNetwork<Node, Link>(network);	}	/**	 * é€£çµæ?åˆ?‚’å–å¾—ã™ã‚?br> 	 * ã‚µã‚¤ã‚ºãŒå¤§ãã„é ?«å–å¾—ã™ã‚?	 * @return	 */	public List<Network> getConnectedComponent(){		List<Network> componentList = new ArrayList<Network>();		Set<Node> nodeSet = new HashSet<Node>(network.getNodeSet());		Set<Node> removedNodeSet = new HashSet<Node>();		for(Node node: nodeSet){			if(removedNodeSet.contains(node)){				continue;			}			Set<Node> componentNodeSet = new HashSet<Node>();			componentNodeSet.add(node);			do{				Set<Node> nextNodeSet = new HashSet<Node>();				for(Node neighbor:componentNodeSet){					nextNodeSet.addAll(neighbor.getLinkedNodeSet());				}				int size = componentNodeSet.size();				componentNodeSet.addAll(nextNodeSet);				if(size == componentNodeSet.size()){					break;				}			}while(true);			componentList.add(new SimpleNetwork<Node, Link>(componentNodeSet));			removedNodeSet.addAll(componentNodeSet);			if(removedNodeSet.size() == nodeSet.size()){				break;			}		}				Collections.sort(componentList, new Comparator<Network>(){			@Override			public int compare(Network o1, Network o2) {				return o2.size()-o1.size();			}		});		return componentList;	}		/**	 * æœ?¤§ã‚³ãƒ³ãƒã?ãƒãƒ³ãƒˆã‚’è¿”ã™	 * @return	 */	public Network getLargestComponent(){		List<Network> componentList = getConnectedComponent();		if(componentList.isEmpty()){			return null;		}		else{			return componentList.get(0);		}	}		/**	 * SNSã®ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯æŒ?¨™ã‚’Mapã§å–å¾—ã™ã‚?	 * @param network å¯¾è±¡SNS	 * @return ã‚¤ãƒ³ãƒ?ƒƒã‚¯ã‚¹ã®MAP	 */	public Map<EnumNetworkIndex, Number> getNetworkIndexMap(){				Map<EnumNetworkIndex, Number> networkIndexMap = new LinkedHashMap<EnumNetworkIndex, Number>();			//long pastTime = sns.getUpdateDate().getTimeInMillis()-sns.getCreateDate().getTimeInMillis();		//int pastDate = (int)(pastTime/(24*60*60*1000));				SimpleNetwork<Node, Link> lcs = new SimpleNetwork(getLargestComponent());		if(lcs == null){			lcs = network;		}				networkIndexMap.put(EnumNetworkIndex.NodeNum, network.size());		networkIndexMap.put(EnumNetworkIndex.LinkNum, network.getLinkSet().size());				DegreeDistributionMap ddm = lcs.getDegreeDistributionMap();		networkIndexMap.put(EnumNetworkIndex.LargestComponentNodeNum, lcs.getNodeSet().size());		networkIndexMap.put(EnumNetworkIndex.LargestComponentLinkNum, lcs.getLinkSet().size());		networkIndexMap.put(EnumNetworkIndex.AveragePath, (double)lcs.getAveragePathLength());		networkIndexMap.put(EnumNetworkIndex.ClusterValue, (double)lcs.getClusterValue());		networkIndexMap.put(EnumNetworkIndex.Assortativity, lcs.getAssortativity());		networkIndexMap.put(EnumNetworkIndex.DegreePowerIndex, ddm.getPowerIndex());		networkIndexMap.put(EnumNetworkIndex.R2, ddm.getR2());		networkIndexMap.put(EnumNetworkIndex.MeanDegree, ddm.getAverageDegree());		networkIndexMap.put(EnumNetworkIndex.MaxDegree, (double)ddm.getMaxDegree());		Double zeroNum = ddm.get(0);		if(zeroNum != null){			networkIndexMap.put(EnumNetworkIndex.DegreeZeroRate, zeroNum);		}		else{			networkIndexMap.put(EnumNetworkIndex.DegreeZeroRate, 0);		}						return networkIndexMap;	}	/**	 * Indexã®ãƒ˜ãƒƒãƒ?‚’è¿”ã™	 * @return	 */	static public String getNetworkIndexStringHead(){		StringBuffer buf = new StringBuffer();		for(EnumNetworkIndex ni:EnumNetworkIndex.values()){			buf.append(ni.toString()+"\t");		}		return buf.toString();	}	public String toString(){		StringBuffer buf = new StringBuffer();		Map<EnumNetworkIndex, Number> indexMap = getNetworkIndexMap();		for(EnumNetworkIndex ni:EnumNetworkIndex.values()){			buf.append(indexMap.get(ni)+"\t");		}		return buf.toString();	}}